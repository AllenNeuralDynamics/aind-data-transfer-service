<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js"></script>
</head>

<body>
  <h2 class="mb-3">Task Instances</h2>
  <h4>DAG Run ID: {{dag_run_id}}</h4>
  <!-- tasks table -->
  <table class="table table-bordered table-striped table-hover table-sm mt-4">
    <tr>
      <th>Task ID</th>
      <th>Try Number</th>
      <th>Priority Weight</th>
      <th>Map Index</th>
      <th>State</th>
      <th>Start Time</th>
      <th>End Time</th>
      <th>Duration</th>
    </tr>
    {% for job_task in job_tasks_list %}
    <tr>
      <td>{{job_task.task_id}}</td>
      <td>{{job_task.try_number}}</td>
      <td>{{job_task.priority_weight}}</td>
      <td>{{job_task.map_index}}</td>
      <td class="{% if job_task.task_state == 'success' %}table-success
                {% elif job_task.task_state == 'failed' %}table-danger
                {% elif job_task.task_state == 'running' %}table-info
                {% endif %}">{{job_task.task_state}}</td>
      <td class="datetime_to_be_adjusted">{{job_task.start_time}}</td>
      <td class="datetime_to_be_adjusted">{{job_task.end_time}}</td>
      <td>{{job_task.duration}}</td>
    </tr>
    {% endfor %}
  </table>
  <!-- display errors to user -->
  {% if status_code != 200 %}
  <div class="alert alert-danger" role="alert">
    <h4 class="alert-heading">{{ message }}</h4>
    <p>
      {% for error in errors %}
        {% if error is string %}{{ error }}
        {% elif error is mapping %}
          {% for key, value in error.items() %}
            <strong>{{ key }}:</strong> {{ value }}<br>
          {% endfor %}
        {% endif %}
      {% endfor %}
    </p>
  </div>
  {% endif %}
  <script>
    window.onload = function () {
      status_code = parseInt('{{ status_code }}')
      if (status_code !== 200) {
        return;
      }
      document.querySelectorAll(".datetime_to_be_adjusted").forEach(function (el) {
        if (el.innerHTML !== "") {
          var utcTime = moment.utc(el.innerText);  // This is the time in UTC
          utcTime.local();  // Switch to using the browser's local timezone
          el.innerText = utcTime.format('YYYY-MM-DD h:mm:ss a');  // Write the local time back to the element
        };
      });
    }
  </script>
</body>

</html>